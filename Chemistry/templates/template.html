<style type='text/css'>
  .form-container {
    width: 100%;
    display: flex;
    align-items: center;
    flex-direction: column;
    overflow: hidden;
  }

  #answers {
      display: flex;
      align-items: center;
      width: auto;
      max-width: 400px;
      overflow: auto;
      border: 1px solid #F5F5F5;
      margin-bottom: 8px;
  }

  .answer {
      position: relative;
      width: {{moleculeSize}}px;
      height: {{moleculeSize}}px;
  }

  .answer div:first-of-type {
      pointer-events: none;
  }
  
  .answer-remove {
      display: block;
      position: absolute;
      color: red;
      top: 16px;
      right: 0;
      font-size: 24px;
      cursor: pointer;
  }

  .arrow {
    display: block;
    margin-bottom: 8px;
    font-size: 48px;
  }

</style>

<!-- https://peter-ertl.com/jsme/JSME_2017-02-26/doc.html -->
<script type="text/javascript" language="javascript" src="https://peter-ertl.com/jsme/JSME_2017-02-26/jsme/jsme.nocache.js"></script>
<script type="text/javascript">
var answers = [];
var editor;

function updateForm() {
   $('#form_answer').val(JSON.stringify(answers.map(e => e.editor.smiles())));
}
function pushEditor(id, mol) {
    document[id] = new JSApplet.JSME(id,  "{{moleculeSize}}px", "{{moleculeSize}}px", {
        "options" : "query,hydrogens,newlook,depict,noshowdraganddropsymbolindepictmode,nozoom",
    });
    document[id].readMolecule(mol);
    document[id].deferredRepaint();
    return document[id];
}

function pushAnswer() {
    const mol = editor.jmeFile();
    if (!mol) {
        alert('{{requiredMessage}}')
        return;
    }
    const count = answers.length;
    const id = 'JME' + (count + 2);
    const node = $('#answers');
    node.append(`
        <div class='answer'>
            <div id='${id}'></div>
            <div class='answer-remove' onclick='removeAnswer("${id}")'>&times</div>
        </div>
    `);
    answers.push({ id: id, editor: pushEditor(id, mol) });
    editor.clear();
    updateForm();
}

function removeAnswer(id) {
    $('#' + id).parent().remove();
    answers = answers.filter(e => e.id !== id);
    updateForm();
    delete document[id];
}

function jsmeOnLoad() {
    pushEditor('molecule', '{{mol}}');
    editor = document['JME2'] = new JSApplet.JSME('editor', "420px", "240px", {
      "options" : "query,hydrogens",
    });
}

</script>

<div class='form-container'>
    <div id='answers'>
        <div id='molecule'></div>
        <div class='arrow'>â†’</div>
    </div>
    <div id="editor"></div>
    <button class='btn btn-light' onclick='pushAnswer()'>{{textButton}}</button>
    <input type="hidden" id="form_answer" value=''/>
</div>






